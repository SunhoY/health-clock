# 개발 계획서: P-35 로그인 사용자 랜딩 자동 리다이렉트

---

## 📌 개발 목표

- 로그인 상태 사용자가 랜딩(S-01)에 진입하면 버튼 클릭 없이 S-02(프리셋 선택)로 즉시 이동한다.
- 인증 세션이 만료/손상된 경우에는 자동 이동을 중단하고 홈 화면에서 재로그인 가능 상태를 유지한다.
- 자동 이동 과정에서 화면 깜빡임과 중복 라우팅을 방지한다.

---

## 🔧 변경 원칙

1. 자동 이동 판단은 로컬 인증 세션을 기준으로 시작한다.
- `localStorage`의 `health-clock.google-auth`를 읽어 토큰 존재 여부를 1차 판단한다.

2. 유효성 검증은 서버 응답으로 확정한다.
- 토큰이 있더라도 `GET /api/routines` 응답이 `401/403`이면 세션을 제거하고 홈에 남는다.

3. 자동 이동은 `replace` 라우팅을 사용한다.
- 브라우저 뒤로가기 시 다시 랜딩으로 튀는 문제를 방지하기 위해 `navigate('/preset-selection', { replace: true })`를 사용한다.

4. 랜딩 CTA 동작은 유지한다.
- `Google로 로그인`, `GUEST로 시작하기` 버튼 동작은 기존과 동일하게 유지한다.

---

## 🧩 대상 문서/코드

- 시나리오
  - `docs/user-scenario/S-01_home.md`
- FE
  - `apps/web-client/src/pages/home/Home.tsx`
  - `apps/web-client/src/pages/home/Home.test.tsx`
  - `apps/web-client/src/pages/preset-selection/presetApi.ts` (인증 세션 유틸 재사용 여부 검토)

---

## 📝 작업 항목

### 1) 시나리오 정합성 반영
- [x] S-01에 "로그인 상태 자동 이동" 규칙 명시
- [x] 세션 무효 시 홈 유지 + 세션 정리 규칙 명시

### 2) 랜딩 자동 이동 로직 구현
- [ ] 홈 진입 시 인증 세션 존재 여부 확인
- [ ] 세션 존재 시 루틴 목록 API 호출로 토큰 유효성 확인
- [ ] 검증 성공 시 `/preset-selection`으로 `replace` 이동
- [ ] 검증 실패(401/403) 시 세션 제거 후 홈 CTA 노출

### 3) 테스트 보강
- [ ] 세션 없음: 자동 이동 없이 홈 CTA 노출 테스트
- [ ] 세션 있음 + 검증 성공: 자동 이동 테스트
- [ ] 세션 있음 + 검증 실패: 세션 제거 및 홈 유지 테스트
- [ ] 버튼 클릭 동작 회귀 테스트

---

## ✅ 완료 기준

- [ ] 로그인 상태 사용자는 랜딩 진입 직후 S-02로 자동 이동한다
- [ ] 만료/손상된 세션은 자동으로 정리되고 홈에서 재로그인 가능하다
- [ ] 랜딩 CTA 동작 회귀 이슈가 없다
- [ ] 관련 테스트가 통과한다
